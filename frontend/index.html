<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTG Playout - Playlist Manager</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="main-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="header-title-row">
                    <h1>RTG PLAYOUT</h1>
                    <button id="addLiveBtn" class="btn-primary btn-small" title="Ajouter une entrée Direct">
                        <span>+ Direct</span>
                    </button>
                </div>
                <div class="channel-info">Canal 1 - Programme Principal</div>
            </div>
            <div class="header-right">
                <div class="autoplay-controls">
                    <button id="autoModeBtn" class="btn-mode mode-manual">
                        <span class="mode-icon">⏯</span>
                        <span class="mode-text" id="modeText">MANUEL</span>
                    </button>
                </div>
                <div class="time-display">
                    <div class="label">Heure actuelle</div>
                    <div class="time" id="currentTime">--:--:--</div>
                </div>
                <div class="time-display">
                    <div class="label">Décalage</div>
                    <div class="time offset-display" id="offsetTime">--:--:--</div>
                </div>
                <div class="time-display">
                    <div class="label">Fin de playlist</div>
                    <div class="time playlist-end" id="playlistEnd">--:--:--</div>
                </div>
            </div>
        </header>

        <!-- Connection Status -->
        <div class="status-bar">
            <div class="status-indicator" id="wsStatus">
                <span class="dot"></span>
                <span class="text">Déconnecté</span>
            </div>
            <div class="playlist-info">
                <span id="itemCount">0</span> élément(s) |
                Durée totale: <span id="totalDuration">00:00:00</span>
            </div>
            <div class="progress-container" id="progressContainer" style="display: none;">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="next-item-info" id="nextItemInfo" style="display: none;">
                <img id="nextItemThumbnail" class="next-thumbnail" src="" alt="Thumbnail"
                    onerror="this.style.display='none'">
                <div class="next-details">
                    <span class="label">Prochain:</span>
                    <span class="next-name" id="nextItemName">--</span>
                    <span class="next-duration" id="nextItemDuration"></span>
                    <span class="countdown" id="nextCountdown">dans --:--</span>
                </div>
            </div>
            <div class="playlist-controls">
                <button id="stopPlaybackBtn" class="btn-stop btn-small">⏹ STOP</button>
                <button id="clearPlaylistBtn" class="btn-danger btn-small">Vider la playlist</button>
            </div>
        </div>

        <div class="content-wrapper">
            <!-- Media Library Panel -->
            <aside class="media-library">
                <div class="panel-header">
                    <h3>Médiathèque</h3>
                    <div class="header-actions">
                        <button id="scanBtn" class="btn-secondary btn-small">
                            <span id="scanBtnText">Scanner</span>
                        </button>
                    </div>
                </div>

                <!-- Folders List -->
                <div class="folders-section">
                    <div class="folders-header">
                        <span>Dossiers</span>
                        <button id="createFolderBtn" class="btn-create-folder" title="Créer un dossier">+</button>
                    </div>
                    <div id="folderList" class="folder-list">
                        <!-- Folders will be inserted here -->
                    </div>
                </div>

                <div class="media-count">
                    <span id="mediaCount">0</span> fichier(s)
                    <span id="selectedFolderName" class="selected-folder"></span>
                </div>
                <div id="mediaList" class="media-list">
                    <!-- Media items will be inserted here -->
                </div>
            </aside>

            <!-- Playlist Section -->
            <main class="playlist-section">
                <div class="playlist-container">
                    <table class="playlist-table">
                        <thead>
                            <tr>
                                <th class="col-index">#</th>
                                <th class="col-name">Nom</th>
                                <th class="col-file">Fichier</th>
                                <th class="col-duration">Durée</th>
                                <th class="col-start">Début prévu</th>
                                <th class="col-end">Fin prévue</th>
                                <th class="col-play">Lecture</th>
                                <th class="col-actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="playlistBody">
                            <!-- Playlist items will be inserted here -->
                        </tbody>
                    </table>
                    <div id="emptyPlaylist" class="empty-state">
                        <p>La playlist est vide</p>
                        <p class="hint">Glissez des fichiers depuis la médiathèque ou utilisez le formulaire ci-dessous
                        </p>
                    </div>
                </div>

                <!-- Add Item Form (for testing) -->
                <div class="add-item-panel">
                    <h3>Ajouter un élément manuellement</h3>
                    <div class="form-row">
                        <input type="text" id="itemName" placeholder="Nom" value="">
                        <input type="text" id="itemFile" placeholder="Fichier" value="">
                        <input type="number" id="itemDuration" placeholder="Durée (s)" value="" min="1">
                        <button id="addItemBtn" class="btn-primary">Ajouter</button>
                    </div>
                </div>
            </main>

            <!-- Graphics/Templates Panel -->
            <aside class="graphics-panel">
                <div class="panel-header">
                    <h3>Graphics / Templates</h3>
                    <button id="toggleGraphicsBtn" class="btn-secondary btn-small">
                        <span id="graphicsToggleIcon">◀</span>
                    </button>
                </div>

                <!-- Presets -->
                <div class="graphics-section">
                    <h4>Presets sauvegardés</h4>
                    <div id="presetList" class="preset-list">
                        <!-- Presets will be inserted here -->
                    </div>
                    <button id="showPresetFormBtn" class="btn-primary btn-small" style="width: 100%; margin-top: 10px;">+ Nouveau preset</button>
                    
                    <div class="preset-io-controls" style="margin-top: 10px; display: flex; gap: 5px;">
                        <button id="exportPresetsBtn" class="btn-secondary btn-small" style="flex: 1;">Exporter</button>
                        <button id="importPresetsBtn" class="btn-secondary btn-small" style="flex: 1;">Importer</button>
                        <input type="file" id="importPresetsInput" accept=".json" style="display: none;">
                    </div>
                </div>

                <!-- Template Controls -->
                <div class="graphics-section">
                    <h4>Contrôle manuel</h4>

                    <div class="template-form">
                        <label>Template</label>
                        <select id="templateName" class="form-control">
                            <option value="">-- Sélectionner --</option>
                            <option value="rtg-lower-third/index">Lower Third</option>
                            <option value="rtg-clock/index">Clock</option>
                            <option value="rtg-countdown/index">Countdown</option>
                            <option value="rtg-full-title/index">Full Title</option>
                            <option value="rtg-logo-clock/index">Logo + Clock</option>
                            <option value="rtg-bug/index">Bug/Logo</option>
                            <option value="rtg-pip/index">PIP Frame</option>
                            <option value="rtg-roll/index">Credits Roll</option>
                            <option value="rtg-election/index">Election Results</option>
                        </select>

                        <label>Layer</label>
                        <select id="templateLayer" class="form-control">
                            <option value="20">20 - Lower Third</option>
                            <option value="30">30 - Bug</option>
                            <option value="40">40 - Full Screen</option>
                            <option value="50">50 - Ticker</option>
                            <option value="60">60 - Clock</option>
                            <option value="70">70 - Countdown</option>
                            <option value="80">80 - Custom</option>
                        </select>

                        <label>Channel</label>
                        <select id="templateChannel" class="form-control">
                            <option value="1">1 - Programme Principal</option>
                            <option value="2">2 - Preview</option>
                        </select>

                        <label>Données (JSON)</label>
                        <textarea id="templateData" class="form-control template-data" rows="6" placeholder='{"title": "Breaking News", "subtitle": "Live from Paris"}'></textarea>

                        <div class="template-actions">
                            <button id="templateLoadBtn" class="btn-secondary btn-small">Load</button>
                            <button id="templatePlayBtn" class="btn-primary btn-small">Play</button>
                            <button id="templateStopBtn" class="btn-warning btn-small">Stop</button>
                            <button id="templateUpdateBtn" class="btn-secondary btn-small">Update</button>
                            <button id="templateRemoveBtn" class="btn-danger btn-small">Remove</button>
                        </div>

                        <button id="templateLoadAndPlayBtn" class="btn-primary" style="width: 100%; margin-top: 10px;">Load & Play</button>
                        <button id="saveAsPresetBtn" class="btn-secondary" style="width: 100%; margin-top: 5px;">Sauvegarder comme preset</button>
                    </div>
                </div>

                <!-- Active Templates -->
                <div class="graphics-section">
                    <h4>Templates actifs</h4>
                    <div id="activeTemplateList" class="active-template-list">
                        <!-- Active templates will be shown here -->
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Save Preset Modal -->
    <div id="presetModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Sauvegarder preset</h3>
                <button class="modal-close" id="closePresetModal">&times;</button>
            </div>
            <div class="modal-body">
                <label>Nom du preset</label>
                <input type="text" id="presetNameInput" class="form-control" placeholder="Ex: Breaking News Red">
            </div>
            <div class="modal-footer">
                <button id="cancelPresetBtn" class="btn-secondary">Annuler</button>
                <button id="confirmPresetBtn" class="btn-primary">Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- Hard Start Time Modal -->
    <div id="hardStartModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Démarrage strict (Hard Start)</h3>
                <button class="modal-close" id="closeHardStartModal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-info">Définir une heure de démarrage stricte pour cet élément. L'élément précédent sera automatiquement ajusté si nécessaire.</p>

                <div id="hardStartStatus" class="hard-start-status" style="display: none;"></div>

                <label>Heure de démarrage</label>
                <input type="time" id="hardStartTimeInput" class="form-control" step="1">

                <div class="hard-start-options">
                    <label class="checkbox-label">
                        <input type="checkbox" id="hardStartEnabledInput">
                        <span>Activer le démarrage strict</span>
                    </label>
                </div>

                <input type="hidden" id="hardStartItemId" value="">
            </div>
            <div class="modal-footer">
                <button id="cancelHardStartBtn" class="btn-secondary">Annuler</button>
                <button id="confirmHardStartBtn" class="btn-primary">Appliquer</button>
            </div>
        </div>
    </div>

    <!-- Secondary Events Modal -->
    <div id="secondaryEventsModal" class="modal" style="display: none;">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3>Événements Secondaires</h3>
                <button class="modal-close" id="closeSecondaryEventsModal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-info">Gérer les événements graphiques (logos, titres) associés à cet élément.</p>

                <div class="events-container">
                    <!-- List of existing events -->
                    <div class="events-list-section">
                        <h4>Événements configurés</h4>
                        <div id="eventsList" class="events-list">
                            <!-- Items will be injected here -->
                            <div class="empty-state-small">Aucun événement configuré</div>
                        </div>
                    </div>

                    <!-- Add New Event Form -->
                    <div class="event-form-section">
                        <h4>Ajouter un événement</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Type</label>
                                <select id="eventTypeInput" class="form-control">
                                    <option value="CG_ADD">Afficher Graphique (CG_ADD)</option>
                                    <option value="CG_STOP">Masquer Graphique (CG_STOP)</option>
                                    <option value="CG_CLEAR">Effacer Layer (CG_CLEAR)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Déclencheur</label>
                                <select id="eventTriggerInput" class="form-control">
                                    <option value="START">Début du clip (START)</option>
                                    <option value="END">Fin du clip (END)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Décalage (ms)</label>
                                <input type="number" id="eventOffsetInput" class="form-control" value="0" min="0" step="100">
                            </div>
                            
                            <div class="form-group">
                                <label>Layer CasparCG</label>
                                <input type="number" id="eventLayerInput" class="form-control" value="20" min="10" max="100">
                            </div>
                        </div>

                        <!-- Template options (only for CG_ADD) -->
                        <div id="eventTemplateOptions" class="template-options">
                            <div class="form-group">
                                <label>Template</label>
                                <select id="eventTemplateInput" class="form-control">
                                    <!-- Options populated from JS -->
                                </select>
                            </div>
                            
                            <div class="form-group full-width">
                                <label>Données (JSON)</label>
                                <textarea id="eventDataInput" class="form-control" rows="3" placeholder='{"text": "Exemple"}'></textarea>
                            </div>
                        </div>

                        <button id="addEventBtn" class="btn-secondary full-width" style="margin-top: 10px;">+ Ajouter l'événement</button>
                    </div>
                </div>

                <input type="hidden" id="secondaryEventsItemId" value="">
            </div>
            <div class="modal-footer">
                <button id="closeSecondaryEventsBtn" class="btn-primary">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Create/Edit Folder Modal -->
    <div id="folderModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="folderModalTitle">Créer un dossier</h3>
                <button class="modal-close" id="closeFolderModal">&times;</button>
            </div>
            <div class="modal-body">
                <label>Nom du dossier</label>
                <input type="text" id="folderNameInput" class="form-control" placeholder="Ex: Publicités">

                <label style="margin-top: 15px;">Couleur</label>
                <div class="color-picker">
                    <div class="color-option" data-color="#118ab2" style="background: #118ab2;"></div>
                    <div class="color-option" data-color="#06d6a0" style="background: #06d6a0;"></div>
                    <div class="color-option" data-color="#e63946" style="background: #e63946;"></div>
                    <div class="color-option" data-color="#f77f00" style="background: #f77f00;"></div>
                    <div class="color-option" data-color="#6c757d" style="background: #6c757d;"></div>
                    <div class="color-option" data-color="#8338ec" style="background: #8338ec;"></div>
                </div>
                <input type="hidden" id="folderColorInput" value="#118ab2">
                <input type="hidden" id="folderIdInput" value="">
            </div>
            <div class="modal-footer">
                <button id="cancelFolderBtn" class="btn-secondary">Annuler</button>
                <button id="confirmFolderBtn" class="btn-primary">Créer</button>
            </div>
        </div>
    </div>

    <!-- Add Live Input Modal -->
    <div id="liveInputModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ajouter une entrée Direct (Live)</h3>
                <button class="modal-close" id="closeLiveInputModal">&times;</button>
            </div>
            <div class="modal-body">
                <label>Nom de l'événement</label>
                <input type="text" id="liveNameInput" class="form-control" placeholder="Ex: DIRECT PLATEAU">

                <label>Source DeckLink</label>
                <select id="liveSourceInput" class="form-control">
                    <option value="1">DeckLink 1</option>
                    <option value="2">DeckLink 2</option>
                    <option value="3">DeckLink 3</option>
                    <option value="4">DeckLink 4</option>
                    <option value="5">DeckLink 5</option>
                    <option value="6">DeckLink 6</option>
                    <option value="7">DeckLink 7</option>
                    <option value="8">DeckLink 8</option>
                </select>

                <label>Durée prévue (HH:MM:SS)</label>
                <input type="text" id="liveDurationInput" class="form-control" value="00:10:00" placeholder="00:10:00">
                <small class="form-help">La durée est utilisée pour le calcul du timing. En mode AUTO, la lecture passera à l'élément suivant après ce délai.</small>
            </div>
            <div class="modal-footer">
                <button id="cancelLiveBtn" class="btn-secondary">Annuler</button>
                <button id="confirmLiveBtn" class="btn-primary">Ajouter à la playlist</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>